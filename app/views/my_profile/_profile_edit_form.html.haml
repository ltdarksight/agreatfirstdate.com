:javascript
  $(document).ready(function(){
    user = new Agreatfirstdate.Models.UserSettings(#{profile.to_json(scope: :settings)});
    formView = new Agreatfirstdate.Views.User.Settings.FormView({user: user});
    formView.render();
  });

= simple_form_for profile, :url => update_profile_path, html: {class: 'form-horizontal', id: 'edit_profile'} do |f|
  -if profile.errors.any?
    #error_explanation
      %h2= "#{pluralize(profile.errors.count, "error")} prohibited this profile from being saved:"
      %ul
        - profile.errors.full_messages.each do |msg|
          %li= msg
  %fieldset
    %legend My Settings
    = f.fields_for :user do |f|
      = f.input :email
    = f.input :gender, collection: Profile::GENDERS.map{|g, title|[title.humanize, g]}, include_blank: false
    = f.input :birthday, as: :string, input_html: {class: 'datepicker', value: (l(f.object.birthday.to_date) if f.object.birthday) }
    = f.input :looking_for, collection: Profile::GENDERS.map{|g, title|[title.humanize.pluralize, g]}, include_blank: false
    = f.input :in_or_around, collection: Profile::LOCATIONS, include_blank: false
    = f.input :looking_for_age, collection: Profile::AGES, include_blank: false, input_html: {class: 'input-small'}


  %fieldset
    %legend Billing Info
    = f.input :first_name
    = f.input :last_name
    = f.input :address, as: :text, input_html: {rows: 2}
    = f.input :zip, input_html: {class: 'input-small'}
    = f.hidden_field :stripe_card_token, value: ''
    .card-left
      = f.input :card_number, input_html: {value: f.object.card_number_masked, autocomplete: :off}
      = f.input :card_type, collection: Profile::CARD_TYPES, input_html: {autocomplete: :off, style: 'height: 28px'}

    .card-right
      = f.input :card_expiration, input_html: {class: 'input-small', autocomplete: :off}
      = f.input :card_cvc, input_html: {class: 'input-small', value: f.object.card_cvc_masked, autocomplete: :off}
    .clearfix
    .control-group
      .controls
        %p.help-block
          Your credit card will be automatically charged each month
          = link_to 'Change Card Details', '#', class: 'change-card_ hidden'
          = link_to 'Verify', '#', class: 'verify_ hidden'
  %fieldset
    %legend Change Password
    = f.fields_for :user do |f|
      = f.input :current_password, as: :password, required: false
      = f.input :password, as: :password, required: false
      = f.input :password_confirmation, as: :password, required: false


  = f.submit 'Save'
  = link_to 'Cancel', my_profile_path

  %fieldset
    %legend Cancel My Account
    .control-group
      .controls
        %p.help-block
          Unhappy?
          = link_to "Cancel my account", registration_path(resource_name), :confirm => "Are you sure?", :method => :delete


