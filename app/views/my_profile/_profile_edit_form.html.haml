:javascript
  $(document).ready(function(){
    window.authenticity_token = "#{form_authenticity_token}";
    window.userRouter = new Agreatfirstdate.Routers.UserRouter({user: #{profile.to_json scope: :self}, owner: true});
    userRouter.settings(#{profile.to_json(scope: :settings)});
    window.router = new Agreatfirstdate.Routers.PillarsRouter({pillars: #{profile.pillars.to_json scope: :self}, pillarCategories: #{PillarCategory.all.to_json(scope: :self)}, userRouter: window.userRouter, owner: true});
    Backbone.history.start();
  });
#event_items_popup

= simple_form_for profile, :url => update_profile_path, html: {class: 'form-horizontal', id: 'edit_profile'} do |f|
  %fieldset
    %legend My Settings
    = f.fields_for :user do |f|
      = f.input :email
    = f.input :gender, collection: Profile::GENDERS.map{|g, title|[title.humanize, g]}, include_blank: false
    = f.input :birthday, as: :string, input_html: {class: 'datepicker', value: (l(f.object.birthday.to_date) if f.object.birthday) }
    = f.input :looking_for, collection: Profile::GENDERS.map{|g, title|[title.humanize.pluralize, g]}, include_blank: false
    = f.input :in_or_around, collection: Profile::LOCATIONS, include_blank: false
    = f.input :looking_for_age, collection: Profile::AGES.keys, include_blank: false, input_html: {class: 'input-small'}

  .control-group= link_to "Change Pillars", "#/pillars/choose"


  %fieldset
    %legend Billing Info
    = f.input :first_name
    = f.input :last_name
    = f.input :address, as: :text, input_html: {rows: 2}
    = f.input :zip, input_html: {class: 'input-small'}
    .control-group
      .card-left
        = f.input :card_number, input_html: {value: f.object.card_number_masked, autocomplete: :off}
        = f.input :card_type, collection: Profile::CARD_TYPES, input_html: {autocomplete: :off, style: 'height: 28px'}
        /= f.input :card_type, input_html: {autocomplete: :off, class: 'uneditable-input', readonly: 'readonly'}

      .card-right
        = f.input :card_expiration, input_html: {class: 'input-small', autocomplete: :off}
        = f.input :card_cvc, input_html: {class: 'input-small', value: f.object.card_cvc_masked, autocomplete: :off}
      .clear
    .control-group
      .controls
        %p.help-block
          Your credit card will be automatically charged each month
          = link_to 'Change Card Details', '#', class: 'change-card_ hidden'
          = link_to 'Verify', '#', class: 'verify_ hidden'
          %span.hidden.verifying_
            Verifying
            = image_tag "verifying.gif"
  %fieldset
    %legend Change Password
    = f.fields_for :user do |f|
      = f.input :current_password, as: :password, required: false
      = f.input :password, as: :password, required: false
      = f.input :password_confirmation, as: :password, required: false


  .submit_block
    = f.button :submit, 'Save'
    = link_to 'Cancel', my_profile_path

  %fieldset
    %legend Cancel My Account
    .control-group
      %p.help-block
        Unhappy?
        = link_to "Cancel my account", registration_path(resource_name), :confirm => "Are you sure?", :method => :delete
